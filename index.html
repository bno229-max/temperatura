<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tabela Clara - HeatMap</title>
    
    <style>
        :root {
            --primary-bg: rgba(255, 255, 255, 0.95);
            --accent-color: #4A90E2;
            --danger: #ff4757;
            --shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Roboto', sans-serif; overflow: hidden; }

        #map { height: 100vh; width: 100%; }

        /* Barra de Busca Estilizada */
        .search-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            width: 90%;
            max-width: 500px;
            display: flex;
            background: var(--primary-bg);
            padding: 5px;
            border-radius: 30px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(5px);
        }

        input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 12px 20px;
            font-size: 16px;
            outline: none;
        }

        .btn-search {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-search:active { transform: scale(0.95); }

        /* Pin de Temperatura Customizado */
        .temp-label {
            background: var(--danger);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            border: 2px solid white;
            box-shadow: var(--shadow);
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div class="search-container">
        <input type="text" id="addressInput" placeholder="Digite um endere√ßo...">
        <button class="btn-search" onclick="handleSearch()">Buscar</button>
    </div>

    <div id="map"></div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAyeljGisp0yk242H4s3VC_xFeBwESDrjU&libraries=visualization"></script>

    <script>
        let map;
        let currentMarker = null;
        let heatmap = null;

        function initMap() {
            // Inicializa o mapa centrado no Brasil
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 5,
                center: { lat: -14.235, lng: -51.925 },
                disableDefaultUI: true,
                zoomControl: true,
                styles: [ /* Estilo Silver/Clean */
                    { "featureType": "poi", "stylers": [{ "visibility": "off" }] }
                ]
            });

            // Tenta localizar o usu√°rio ao abrir
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const pos = { lat: position.coords.latitude, lng: position.coords.longitude };
                    map.setCenter(pos);
                    map.setZoom(15);
                    addTemperatureMarker(pos, "Sua Localiza√ß√£o");
                });
            }
        }

        async function handleSearch() {
            const address = document.getElementById('addressInput').value;
            if (!address) return;

            const geocoder = new google.maps.Geocoder();
            
            geocoder.geocode({ address: address }, (results, status) => {
                if (status === "OK") {
                    const location = results[0].geometry.location;
                    
                    // 1. Limpa marcador anterior
                    if (currentMarker) currentMarker.setMap(null);
                    
                    map.setCenter(location);
                    map.setZoom(16);
                    
                    addTemperatureMarker(location, results[0].formatted_address);
                    showHeatEffect(location);
                } else {
                    alert("Local n√£o encontrado.");
                }
            });
        }

        function addTemperatureMarker(location, title) {
            // Simula√ß√£o de temperatura (Integrar com OpenWeather depois)
            const temp = Math.floor(Math.random() * (38 - 15) + 15);
            
            // Criando um elemento HTML para o PIN
            const label = document.createElement('div');
            label.className = 'temp-label';
            label.innerHTML = `üå°Ô∏è ${temp}¬∞C`;

            currentMarker = new google.maps.Marker({
                position: location,
                map: map,
                title: title,
                // Usando √≠cone invis√≠vel para mostrar apenas o label customizado se desejar, 
                // ou apenas o marker padr√£o com InfoWindow:
            });

            const infowindow = new google.maps.InfoWindow({
                content: `<div style="color:black"><b>${title}</b><br>Temperatura: ${temp}¬∞C</div>`
            });
            infowindow.open(map, currentMarker);
        }

        function showHeatEffect(location) {
            // Efeito de Mapa de Calor ao redor do ponto buscado
            const heatData = [
                {location: location, weight: 3},
                new google.maps.LatLng(location.lat() + 0.001, location.lng() + 0.001),
                new google.maps.LatLng(location.lat() - 0.001, location.lng() - 0.001)
            ];

            if (heatmap) heatmap.setMap(null);

            heatmap = new google.maps.visualization.HeatmapLayer({
                data: heatData,
                map: map,
                radius: 50
            });
        }

        // Permitir busca ao apertar Enter
        document.getElementById('addressInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSearch();
        });

        window.onload = initMap;
    </script>
</body>
</html>